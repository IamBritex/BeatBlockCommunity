<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="index.css">
    <link rel="shortcut icon" href="https://beatblock.wiki.gg/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeatBlock Community</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- Navbar -->
    <nav>
        <img src="https://beatblock.wiki.gg/favicon.ico" alt="BeatBlock Logo" class="logo">
        <div>
            BeatBlock Community
        </div>
        
        <div class="search-container">
            <button class="filter-btn">
                <span class="material-symbols-outlined">tune</span>
                <span>Filters</span>
            </button>
            <input type="text" class="search-input" placeholder="Search levels...">
            <span class="material-symbols-outlined search-icon">search</span>
        </div>

        <div class="auth-buttons" id="auth-buttons">
            <button class="auth-btn" id="login-btn">Login</button>
            <button class="auth-btn" id="register-btn">Register</button>
        </div>
        <div class="user-info" id="user-info" style="display: none;">
            <img id="user-photo" alt="Profile Picture" class="profile-pic">
            <span id="user-name"></span>
            <button class="upload-btn" onclick="window.location.href='upload.html'">Upload Level</button>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <img src="https://beatblock.wiki.gg/images/a/a9/Beatblock_logo.png" alt="BeatBlock" class="game-logo">
        <button class="download-btn">
            <span class="material-symbols-outlined">download</span>
            Download Now
        </button>
    </section>

    <!-- Levels Grid -->
    <div class="levels-grid" id="levels-grid">
        <!-- This will be dynamically populated -->
    </div>

    <!-- No Levels Message -->
    <div id="no-levels" style="display: none; text-align: center; margin: 20px;">
        <p>No levels are available at the moment. Be the first to upload a level!</p>
    </div>

    <script>

        const firebaseConfig = {
            apiKey: "AIzaSyAkCSNglCmPI8kU2UnB0DfCZN5d3F0qKew",
            authDomain: "beatblockcommunity-be8d7.firebaseapp.com",
            projectId: "beatblockcommunity-be8d7",
            storageBucket: "beatblockcommunity-be8d7.firebasestorage.app",
            messagingSenderId: "661527648636",
            appId: "1:661527648636:web:6beb30be83a0df72542cf9",
            measurementId: "G-BDZR1G380X"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.getAuth();
        const db = firebase.getFirestore();

// Inicializar Firebase
firebase.initializeApp(firebaseConfig);


// Verificar el estado de autenticación
auth.onAuthStateChanged((user) => {
    const userInfo = document.getElementById("user-info");
    const uploadButton = document.getElementById("upload-button");

    if (user) {
        // Usuario autenticado
        userInfo.innerHTML = `
            <img src="${user.photoURL}" alt="Profile" width="30">
            <span>${user.displayName}</span>
        `;
        uploadButton.style.display = "block"; // Mostrar botón de subir nivel
    } else {
        // Usuario no autenticado
        userInfo.innerHTML = '<button onclick="login()">Login</button>';
        uploadButton.style.display = "none"; // Ocultar botón de subir nivel
    }
});

// Mostrar niveles si hay datos en la base de datos
const levelsGrid = document.getElementById("levels-grid");
db.collection("levels").get().then((querySnapshot) => {
    if (querySnapshot.empty) {
        levelsGrid.innerHTML = "<p>No hay niveles disponibles.</p>";
    } else {
        querySnapshot.forEach((doc) => {
            const level = doc.data();
            levelsGrid.innerHTML += `
                <div class="level-card">
                    <img src="${level.thumbnail}" alt="${level.title}">
                    <div>
                        <h3>${level.title}</h3>
                        <p>Creado por ${level.creator}</p>
                    </div>
                </div>
            `;
        });
    }
}).catch((error) => {
    console.error("Error al obtener niveles:", error);
});

// Función de inicio de sesión
function login() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then((result) => {
        console.log("Usuario autenticado:", result.user);
    }).catch((error) => {
        console.error("Error en la autenticación:", error);
    });
}

    </script>
</body>
</html>
